<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Feuerwehr Feedback</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase (modular SDK fÃ¼r Firestore) -->
  <!-- Es ist wichtig, das `type="module"` Attribut hinzuzufÃ¼gen, um Importe zu verwenden. -->
  <!-- Verwende die neueste stabile Version (z.B. 10.x.x) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    // === Deine Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyBW7F4lrLQG8-OqLaE9hpXI9QxdTWaThXo",
      authDomain: "ffnfeedback.firebaseapp.com",
      // databaseURL ist fÃ¼r die Realtime Database und wird fÃ¼r Firestore nicht benÃ¶tigt
      projectId: "ffnfeedback",
      storageBucket: "ffnfeedback.appspot.com",
      messagingSenderId: "469095529693",
      appId: "1:469095529693:web:b8f8a1c24593b67c9e6f34",
      measurementId: "G-CDDM310YEW"
    };

    // === Firebase starten ===
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); // Firestore initialisieren

    async function saveFeedback() { // Funktion asynchron machen
      const rating = document.getElementById('rating').value;
      const comment = document.getElementById('comment').value.trim();

      if (!rating) return alert("Bitte eine Bewertung auswÃ¤hlen!");

      try {
        await addDoc(collection(db, "feedbacks"), { // Daten zu einer "feedbacks"-Sammlung hinzufÃ¼gen
          rating: Number(rating),
          comment: comment,
          timestamp: new Date().toISOString() // Oder lieber: firebase.firestore.Timestamp.fromDate(new Date()) fÃ¼r Firestore-typische Zeitstempel
        });
        document.getElementById('comment').value = '';
        alert("Danke fÃ¼r dein Feedback!");
      } catch (e) {
        console.error("Fehler beim HinzufÃ¼gen des Dokuments: ", e);
        alert("Es gab einen Fehler beim Speichern deines Feedbacks.");
      }
    }

    // === Feedback live laden ===
    // Eine Abfrage fÃ¼r die "feedbacks"-Sammlung erstellen, nach Zeitstempel sortiert
    const q = query(collection(db, "feedbacks"), orderBy("timestamp", "desc"));

    // onSnapshot hÃ¶rt in Echtzeit auf Ã„nderungen in der Sammlung
    onSnapshot(q, (snapshot) => {
      const feedbacks = [];
      snapshot.forEach((doc) => {
        // FÃ¼r jedes Dokument die Daten abrufen
        feedbacks.push(doc.data());
      });
      updateChart(feedbacks);
    }, (error) => {
      console.error("Fehler beim AbhÃ¶ren von Dokumenten: ", error);
    });

    // Diese Funktionen mÃ¼ssen global verfÃ¼gbar sein, wenn sie direkt aus dem HTML aufgerufen werden.
    // Eine MÃ¶glichkeit ist, sie ans Window-Objekt zu hÃ¤ngen.
    window.saveFeedback = saveFeedback;
    window.updateChart = updateChart; // Wenn auch diese direkt aus HTML aufgerufen wÃ¼rde, hier nicht der Fall

    function updateChart(feedbacks) {
      const counts = [0,0,0,0,0];
      feedbacks.forEach(f => counts[f.rating - 1]++);

      const ctx = document.getElementById('feedbackChart').getContext('2d');
      if (window.chartInstance) window.chartInstance.destroy();
      window.chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['1', '2', '3', '4', '5'],
          datasets: [{
            label: 'Bewertungen',
            data: counts,
            backgroundColor: '#b30000'
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      const list = document.getElementById('commentsList');
      list.innerHTML = feedbacks
        .filter(f => f.comment)
        .map(f => `<li>${f.comment}</li>`)
        .join('');
    }
  </script>
</head>
<body>
  <div class="card">
    <h1>ðŸ§¯ Feuerwehr Feedback</h1>
    <p>Hier kannst du anonym Feedback zu Ãœbungen geben. Keine Namen, kein Login â€“ nur ehrliche RÃ¼ckmeldung.</p>

    <label for="rating">Bewertung (1 = schlecht, 5 = super):</label>
    <label for="exercise">Ãœbung:</label>
    <select id="exercise">
      <option value="Allgemein">Allgemein</option>
      <option value="AtemschutzÃ¼bung">AtemschutzÃ¼bung</option>
      <option value="Verkehrsunfall">Verkehrsunfall</option>
      <option value="THL-Einsatz">THL-Einsatz</option>
      <option value="BrandÃ¼bung">BrandÃ¼bung</option>
      <option value="FunkÃ¼bung">FunkÃ¼bung</option>
      <option value="Sonstiges">Sonstiges</option>
    </select>

    <select id="rating">
      <option value="1">1</option><option value="2">2</option>
      <option value="3">3</option><option value="4">4</option>
      <option value="5">5</option>
    </select>

    <label for="comment">Kommentar (optional):</label>
    <textarea id="comment" rows="3" placeholder="Was war gut, was kann besser werden?"></textarea>

    <button onclick="saveFeedback()">Absenden</button>
  </div>

  <div class="card" id="chartContainer">
    <h2>ðŸ“Š Auswertung</h2>
    <canvas id="feedbackChart"></canvas>
    <ul id="commentsList"></ul>
  </div>
</body>
</html>


  <script src="script.js"></script>
</body>
</html>
